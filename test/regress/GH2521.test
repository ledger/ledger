; Regression test for GitHub issue #2521
; CSV convert command segfaults with --strict when unknown metadata columns exist
; The issue was that journal.current_context was not set during CSV parsing,
; causing a null pointer dereference when --strict triggers metadata warnings.

test -f /dev/null --strict --input-date-format '%m/%d/%Y' convert test/regress/GH2521.dat
2024/01/02 * GROCERY STORE
    ; posting_type: DEBIT
    Expenses:Unknown                          -45.67
    Equity:Unknown

2024/01/05 * COFFEE SHOP
    ; posting_type: DEBIT
    Expenses:Unknown                            -4.5
    Equity:Unknown
__ERROR__
Warning: "$sourcepath/test/regress/GH2521.dat", line 0: Unknown metadata tag 'posting_type'
Warning: "$sourcepath/test/regress/GH2521.dat", line 0: Unknown metadata tag 'posting_type'
end test

; Tests for more report.cc uncovered lines and lookup paths
; Covers: report.cc lines 75 77 529 532 1020-1023
;   1659 1678-1679 1681 1701 1720 1724 1734 1737

; --- Journal data ---
2024/01/01 Grocery Store
    Expenses:Food              $50.00
    Assets:Cash

2024/01/15 Gas Station
    Expenses:Auto:Gas          $35.00
    Assets:Cash

; --- Test 1: --output writes to file, stdout is empty (lines 74-77) ---
; The --output option suppresses color and pager, output goes to file
; When stdout is empty, the test passes with no expected output
test reg --output /dev/null Expenses
end test

; --- Test 2: fn_display_amount via t function alias ---
test reg --format "%(t)\n" Expenses:Food
$50.00
end test

; --- Test 3: fn_display_total via T function alias ---
test reg --format "%(T)\n" Expenses:Food
$50.00
end test

; --- Test 4: fn_should_bold (line 572-577) ---
test reg --format "%(should_bold ? \"B\" : \"N\")\n" Expenses:Food
N
end test

; --- Test 5: fn_now (via d alias, line 1324) ---
; d and m map to fn_now which returns current datetime
; We can't check exact value, but verify it doesn't error
test reg --format "%(m ? \"ok\" : \"ok\")\n" Expenses:Food
ok
end test

; --- Test 6: fn_unrounded (line 683-684) ---
test reg --format "%(unrounded(amount))\n" Expenses:Food
$50.00
end test

; --- Test 7: fn_rounded (line 679-680) ---
test reg --format "%(rounded(amount))\n" Expenses:Food
$50.00
end test

; --- Test 8: fn_floor (line 695-697) ---
test reg --format "%(floor(amount))\n" Expenses:Food
$50.00
end test

; --- Test 9: fn_ceiling (line 699-701) ---
test reg --format "%(ceiling(amount))\n" Expenses:Food
$50.00
end test

; --- Test 10: fn_round (line 703-705) ---
test reg --format "%(round(amount))\n" Expenses:Food
$50.00
end test

; --- Test 11: fn_unround (line 711-713) ---
test reg --format "%(unround(amount))\n" Expenses:Food
$50.00
end test

; --- Test 12: fn_abs (line 715-717) ---
test reg --format "%(abs(amount))\n" Assets:Cash
$50.00
$35.00
end test

; --- Test 13: fn_truncate (line 691-693) ---
test reg --format "%(truncate(amount))\n" Expenses:Food
$50.00
end test

; --- Test 14: fn_quoted (line 740-754) ---
test reg --format "%(quoted(payee))\n" Expenses:Food
"Grocery Store"
end test

; --- Test 15: fn_quoted_rfc (line 756-770) ---
test reg --format "%(quoted_rfc(payee))\n" Expenses:Food
"Grocery Store"
end test

; --- Test 16: print command (line 1662-1663) ---
test print Expenses:Food
2024/01/01 Grocery Store
    Expenses:Food                             $50.00
    Assets:Cash
end test

; --- Test 17: fn_clear_commodity (line 858-862) ---
test reg --format "%(clear_commodity(amount))\n" Expenses:Food
50
end test

; --- Test 18: eval precommand (line 1712-1713) ---
test eval "2 + 3"
5
end test

; --- Test 19: fn_format via lookup ---
test reg --format "%(format(\"hello\"))\n" Expenses:Food
hello
end test

; --- Test 20: fn_format_date via lookup ---
test reg --format "%(format_date(date, \"%Y/%m/%d\"))\n" Expenses:Food
2024/01/01
end test

; --- Test 21: budget command (line 1615-1622) ---
test budget Expenses
end test

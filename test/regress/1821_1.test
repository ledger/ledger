; Test for issue #1821 - Bug 1: Multiple prices on same day (stock split)
; Unrealized gains/losses should be correctly calculated when there are
; multiple price changes on the same day within a single transaction.

2004-05-01 Stock purchase
    Assets:Broker     10 AAPL @ $50
    Equity:Broker

2004-05-02 * Stock Split
    Assets:Broker     -10 AAPL @ $50
    Assets:Broker     100 AAPL @ $5

; After the stock split, we have 100 shares at $5 = $500, which is the
; same total value as before (10 shares at $50 = $500). There should be
; no unrealized gains or losses.

test bal --unrealized --market
                $500  Assets:Broker
               $-500  Equity:Broker
--------------------
                   0
end test

; The register view may show adjustments, but the balance should be correct
test reg --market
04-May-01 Stock purchase        Assets:Broker                  $500         $500
                                Equity:Broker                 $-500            0
04-May-02 Commodities revalued  <Revalued>                    $-450        $-450
04-May-02 Stock Split           Assets:Broker                  $-50        $-500
                                Assets:Broker                  $500            0
end test

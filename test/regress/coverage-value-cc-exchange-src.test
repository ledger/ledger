; Test value.cc: exchange_commodities with source-specific conversion
; Exercises lines 1553-1555, 1567-1569, 1613 (A:B syntax)

P 2024/01/15 EUR $1.10
P 2024/01/15 GBP $1.30

2024/01/15 Purchase Food
    Expenses:Food    50 EUR
    Assets:Checking

2024/01/15 Purchase Transport
    Expenses:Transport  30 GBP
    Assets:Checking

; Use EUR:$ syntax to convert only EUR to $ (exercises source-specific path)
; GBP should remain unconverted
test bal --exchange "EUR:$" --columns 80
             $-55.00
             -30 GBP  Assets:Checking
              $55.00
              30 GBP  Expenses
              $55.00    Food
              30 GBP    Transport
--------------------
                   0
end test

; Exercise AMOUNT path with --flat (each account balance is a single amount)
; For Transport (30 GBP), sources[index]=EUR but amount is GBP, so line 1585-1586 reached
test bal --exchange "EUR:$" --flat --columns 80
             $-55.00
             -30 GBP  Assets:Checking
              $55.00  Expenses:Food
              30 GBP  Expenses:Transport
--------------------
                   0
end test

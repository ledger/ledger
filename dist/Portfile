# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                ledger-devel
version             3.0-20100611
homepage            http://www.newartisans.com/software/ledger.html
categories          finance accounting reporting

description         A command-line, double-entry accounting tool.
long_description    Ledger is a powerful, double-entry accounting system that \
                    is accessed from the UNIX command-line.

maintainers         johnw@newartisans.com

platforms           darwin

use_bzip2           yes
master_sites        http://ftp.newartisans.com/pub/ledger/:source
distname            ${name}-${version}
distfiles           ${distname}${extract.suffix}:source
checksums           ${distname}${extract.suffix} \
                        md5     0ab9a855719df536a85f7ea5238b8a6e \
                        sha1    e2ee9e2951fd37bac50c91046f097c11294a6e8e \
                        rmd160  72cdfe76add63425b1ade1d03479e837e9f2dafe

depends_build       port:automake \
                    port:autoconf \
                    port:libtool

depends_lib         port:gettext \
                    port:gmp \
                    port:mpfr \
                    port:boost \
                    port:libedit

# gmp and mpfr are not universal
universal_variant   no

configure.args      --with-extra-includes=${prefix}/include \
                    --with-extra-libs=${prefix}/lib

build.args          DYLD_LIBRARY_PATH=${worksrcpath}/ledger/.libs

platform darwin 9 {}
platform darwin 10 {}

destroot.args       DESTDIR=${destroot}${prefix} \
                    DYLD_LIBRARY_PATH=${worksrcpath}/ledger/.libs \
                    docprefix=${destroot}/share/doc

post-destroot {}

variant debug description {Enable debug mode} {
    configure.args-append   --enable-debug=yes
}

variant icu description {Enable full Unicode support} {
    if {[variant_isset python25]} {
        depends_lib-delete      port:boost+python25
        depends_lib-append      port:boost+icu+python25
    }
    else if {[variant_isset python26]} {
        depends_lib-delete      port:boost+python26
        depends_lib-append      port:boost+icu+python26
    }
    else {
        depends_lib-delete      port:boost
        depends_lib-append      port:boost+icu
    }
}

variant python25 description {build python 2.5 support} conflicts python26 {
    set pyversion       2.5
    if {[variant_isset icu]} {
        depends_lib-delete      port:boost+icu
        depends_lib-append      port:boost+icu+python25
    }
    else {
        depends_lib-delete      port:boost
        depends_lib-append      port:boost+python25
    }
    depends_lib-append          port:python25
}

variant python26 description {build python 2.6 support} conflicts python25 {
    set pyversion       2.6
    if {[variant_isset icu]} {
        depends_lib-delete      port:boost+icu
        depends_lib-append      port:boost+icu+python26
    }
    else {
        depends_lib-delete      port:boost
        depends_lib-append      port:boost+python26
    }
    depends_lib-append          port:python26
}

#livecheck.check     regex
#livecheck.url       ${homepage}
#livecheck.regex     "Latest Stable Ledger \\(Version (\\d+.\\d+.\\d+)\\)"

